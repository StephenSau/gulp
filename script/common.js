!function(e){"use strict";e(["jquery","dialog","info","cookie","json"],function(e,t,s){function i(){this.name="",this.id="",this.prefix="/",this.message=0,this.init()}return i.FRONTPAGE=["index","service_detail","service_provider","provider_detail","404","500","about","aptitude","chronicle","contact","exempt","help","help_detail","help_list","help_search","jobs","news","news_detail","news_list","SearchArticleList","team"],i.NORETURNPAGE=[],i.BACKPAGE=["login","register","404","500","order_commit","order_detail","order_list","setting","modify_password","message","gotoEditOrder","createOrderPage"],i.prototype={init:function(){this.getUserInfo(),this.watchLink(),this.mapCtrl(),this.codeBoxCtrl(),this.assist(),this.addQQTalk(),this.searchFormCtrl()},addQQTalk:function(){var e="1001",t=window.location.href;-1!==t.indexOf("service_detail")||-1!==t.indexOf("service_provider")||-1!==t.indexOf("provider_detail")?e="1002":this.isOnBack()&&(e="1003");try{BizQQWPA.addCustom([{aty:"1",a:e,nameAccount:4008310866,node:document.body},{aty:"1",a:e,nameAccount:4008310866,selector:"qqTalk_fixed_btn_01"},{aty:"1",a:e,nameAccount:4008310866,selector:"qqTalk_fixed_btn_02"},{aty:"1",a:e,nameAccount:4008310866,selector:"qqTalk_header_btn_01"},{aty:"1",a:e,nameAccount:4008310866,selector:"qqTalk_backyard_btn_01"},{aty:"1",a:e,nameAccount:4008310866,selector:"qqTalk_font_btn_01"}])}catch(s){}},searchFormCtrl:function(){var t=document.getElementById("articleSearchForm");e(t).submit(function(e){e.preventDefault(),window.location.href="/so/"+encodeURIComponent(t.querycondition.value)})},watchLink:function(){e(document).delegate("a","click",e.proxy(this.beforeJump,this))},beforeJump:function(){this.isOnBack()||e.cookie("backpage",window.location.href)},getUserInfo:function(){this.name=e.cookie("username"),this.id=e.cookie("id"),this.id?this.getMsgDigest():this.changeStatus(!1)},mapCtrl:function(){var t=e("#h_map");e("#h_showMap").on("mouseenter",function(){t.data("status")&&"hidden"!==t.data("status")?(t.hide(),t.data("status","hidden")):(t.show(),t.data("status","show"))}),t.on("mouseleave",function(){t.hide(),t.data("status","hidden")})},codeBoxCtrl:function(){var t=e("#h_codeBox");e("#h_showCodeBox").on("mouseenter",function(){t.data("status")&&"hidden"!==t.data("status")?(t.hide(),t.data("status","hidden")):(t.show(),t.data("status","show"))}),t.on("mouseleave",function(){t.hide(),t.data("status","hidden")})},getMsgDigest:function(){var t=this;e.ajax({url:this.prefix+"user/qryMsgDigest.htm",data:"",dataType:"json",method:"POST",xhrFields:{withCredentials:!0},success:function(e){"200"===e.status?(t.message=e.re.count,t.changeStatus(!0)):t.delUserInfo()},error:function(e){}})},changeStatus:function(t){var s=this,i=[];document.getElementById("h_status")&&(t?(i.push("<li>"+this.name+' <a id="h_loginout" href="javascript:;">退出</a></li>'),i.push('<li><a href="/app/message.html">消息通知</a> <span class="h_red"'+("0"===this.message?' style="display:none"':"")+">"+this.message+"</span></li>"),i.push('<li class="h_noline"><a href="/app/order_list.html">我的订单</a></li>')):(i.push('<li><a href="/app/register.html" class="line">注册</a></li>'),i.push('<li class="h_noline"><a id="loginBtn" href="javascript:;">登录</a></li>')),e("#h_status").html(i.join("")),document.getElementById("h_loginout")&&e("#h_loginout").unbind("click").bind("click",e.proxy(this.loginOut,this)),document.getElementById("loginBtn")&&e("#loginBtn").on("click",function(e){s.showLoginBox()}))},showLoginBox:function(t){var i=this,o=[],n=e.cookie("accountname");o.push('<div class="ui-info-loginBox">'),o.push("<h3>用户登录</h3>"),o.push('<form action="/user/login" name="popupLoginform" id="login_form">'),o.push('<ol id="loginForm">'),o.push('<li class="ui-tips" id="ui-tips">测试</li>'),o.push("<li>"),o.push('<label class="lb_title" for="l_name">用户名</label>'),o.push('<input class="lb_text" type="text" id="l_name" name="username" tabindex="1" maxlength="20" value="'+(n?n:"")+'" />'),o.push("</li>"),o.push("<li>"),o.push('<label class="lb_title" for="l_password">密码</label>'),o.push('<input class="lb_text" type="password" id="l_password" name="password" tabindex="2" maxlength="20" />'),o.push('<a class="lb_find" href="javascript:;" onclick="document.getElementById(\'qqTalk_header_btn_01\').click()">找回密码</a>'),o.push('<li class="lb_rememberline">'),o.push('<input checked="checked" type="checkbox" name="rememberme" id="l_remember" tabindex="3">'),o.push('<label for="l_remember">记住用户名</label>'),o.push("</li>"),o.push('<li class="lb_btnline">'),o.push('<button type="submit" class="btn btn_warning">登录</button>'),o.push("</li>"),o.push("</ol>"),o.push("</form>"),o.push('<p class="lb_registerline">还没注册？<a href="/app/register.html">免费注册</a></p>'),o.push("</div>"),s.show({content:o.join("")}),e(document.forms.popupLoginform).submit(function(e){e.preventDefault(),i.loginPass(t)})},loginPass:function(t){var i=this,o=document.forms.popupLoginform,n=e("#ui-tips"),a={username:o.username.value,password:o.password.value};return o.username.value?o.password.value?void e.ajax({url:"/user/login.htm",data:a,dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(a){"200"===a.status?(o.rememberme.checked?e.cookie("accountname",o.username.value,{expires:7,path:"/"}):e.removeCookie("accountname",{path:"/"}),i.setUserInfo(a.re),i.getUserInfo(),"function"==typeof t&&t(),s.close()):(e(o.username).removeAttr("style"),e(o.password).removeAttr("style"),n.html(a.errormsg).show(),"3001"===a.errorcode?e(o.username).css({"border-color":"#db281f"}):"3119"===a.errorcode&&e(o.password).css({"border-color":"#db281f"}))},error:function(e){}}):(n.html("请填写密码").show(),void e(o.password).css({"border-color":"#db281f"})):(n.html("请填写用户名").show(),void e(o.username).css({"border-color":"#db281f"}))},loginOut:function(){var t=this;e.ajax({url:this.prefix+"user/loginout.htm",data:"",dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(e){"200"===e.status&&(t.isOnBack()?(t.delUserInfo(),t.changeStatus(!1),window.location.href="/"):(t.delUserInfo(),t.changeStatus(!1)))},error:function(e){}})},errorDialog:function(e){var s=this,i=e.errormsg,o=e.errorcode,n=[];"1034"===o||"3400"===o||"3000"===o?(this.delUserInfo(),this.changeStatus(!1),n=[{name:"重新登录",callBack:function(){t.close(),s.showLoginBox()}}]):n=[{name:"确定",callback:function(){t.close()}}],t.show({content:i,buttons:n})},isOnBack:function(){var e=0,t=window.location.href,s=i.BACKPAGE.length,o=!1;for(e=0;s>e;e+=1)if(-1!==t.indexOf(i.BACKPAGE[e])){o=!0;break}return o},delUserInfo:function(){e.removeCookie("username",{path:"/"}),e.removeCookie("id",{path:"/"})},setUserInfo:function(t){var s="";for(s in t)t.hasOwnProperty(s)&&e.cookie(s,t[s],{expires:7,path:"/"})},getParams:function(e){if(window.location.search){var t=window.location.search.substring(1).split("&"),s={},i=0;for(i=0;i<t.length;i+=1)s[t[i].split("=")[0]]=t[i].split("=")[1];return s[e]?s[e]:""}return""},getAreaById:function(t){e.ajax({url:this.prefix+"area/getAreaById.htm",data:"",dataType:"json",type:"get",success:function(e){t("200"===e.status?e.re:{province:"440000",city:"440100",area:"440106"})},error:function(e){t({province:"440000",city:"440100",area:"440106"})}})},saveParams:function(t){var s="";for(s in t)t.hasOwnProperty(s)&&("object"==typeof t[s]?(e.removeCookie(s),e.cookie(s,e.toJSON(t[s]))):e.cookie(s,t[s]))},assist:function(){var t=null,s='<div id="fixed_box" class="fixed_box"><a href="javascript:void(0);" id="qqTalk_fixed_btn_01">在线客服</a><a href="javascript:void(0);" id="qqTalk_fixed_btn_02">意见反馈</a><a id="topBtn" href="javascript:void(0);"><i class="icon"></i>顶部</a></div>',i=function(){var t=0,s=e(window).scrollTop(),i=0,o=360,n=0,a=function(e,t,s,i,o){return s>i?(n=i,i=s,s=n,i-(-i*Math.cos(t/o*(Math.PI/2))+i+s)):-i*Math.cos(t/o*(Math.PI/2))+i+s},r=function(){t>=o?(e(window).scrollTop(i),e(this).css({visibility:"hidden"})):(e(window).scrollTop(a(0,t,s,i,o)),setTimeout(r,30)),t+=30};r()},o=function(){e(this).scrollTop()>0?t.css({visibility:"visible"}):t.css({visibility:"hidden"})};e("body").append(s),t=e("#topBtn"),e(window).on("scroll",o),t.on("click",i),o.call(window)}},new i})}(window.define);